(()=>{var a;!function(a){a.LOAD="LOAD",a.EXEC="EXEC",a.WRITE_FILE="WRITE_FILE",a.READ_FILE="READ_FILE",a.DELETE_FILE="DELETE_FILE",a.RENAME="RENAME",a.CREATE_DIR="CREATE_DIR",a.LIST_DIR="LIST_DIR",a.DELETE_DIR="DELETE_DIR",a.ERROR="ERROR",a.DOWNLOAD="DOWNLOAD",a.PROGRESS="PROGRESS",a.LOG="LOG",a.MOUNT="MOUNT",a.UNMOUNT="UNMOUNT"}(a||(a={}));const e=new Error("unknown message type"),t=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first");new Error("called FFmpeg.terminate()"),new Error("failed to import ffmpeg-core.js");let r;self.onmessage=async({data:{id:o,type:s,data:n}})=>{const c=[];let i;try{if(s!==a.LOAD&&!r)throw t;switch(s){case a.LOAD:i=await(async({coreURL:e,wasmURL:t,workerURL:o})=>{const s=!r;importScripts(e);const n=e,c=t||e.replace(/.js$/g,".wasm"),i=o||e.replace(/.js$/g,".worker.js");return r=await createFFmpegCore({mainScriptUrlOrBlob:`${n}#${btoa(JSON.stringify({wasmURL:c,workerURL:i}))}`}),r.setLogger((e=>self.postMessage({type:a.LOG,data:e}))),r.setProgress((e=>self.postMessage({type:a.PROGRESS,data:e}))),s})(n);break;case a.EXEC:i=(({args:a,timeout:e=-1})=>{r.setTimeout(e),r.exec(...a);const t=r.ret;return r.reset(),t})(n);break;case a.WRITE_FILE:i=(({path:a,data:e})=>(r.FS.writeFile(a,e),!0))(n);break;case a.READ_FILE:i=(({path:a,encoding:e})=>r.FS.readFile(a,{encoding:e}))(n);break;case a.DELETE_FILE:i=(({path:a})=>(r.FS.unlink(a),!0))(n);break;case a.RENAME:i=(({oldPath:a,newPath:e})=>(r.FS.rename(a,e),!0))(n);break;case a.CREATE_DIR:i=(({path:a})=>(r.FS.mkdir(a),!0))(n);break;case a.LIST_DIR:i=(({path:a})=>{const e=r.FS.readdir(a),t=[];for(const o of e){const e=r.FS.stat(`${a}/${o}`),s=r.FS.isDir(e.mode);t.push({name:o,isDir:s})}return t})(n);break;case a.DELETE_DIR:i=(({path:a})=>(r.FS.rmdir(a),!0))(n);break;case a.MOUNT:i=(({fsType:a,options:e,mountPoint:t})=>{const o=a,s=r.FS.filesystems[o];return!!s&&(r.FS.mount(s,e,t),!0)})(n);break;case a.UNMOUNT:i=(({mountPoint:a})=>(r.FS.unmount(a),!0))(n);break;default:throw e}}catch(e){return void self.postMessage({id:o,type:a.ERROR,data:e.toString()})}i instanceof Uint8Array&&c.push(i.buffer),self.postMessage({id:o,type:s,data:i},c)}})();